# sneaker_manager/app/utils.pyfrom PIL import Image, ImageTkimport tkinter as tkfrom functools import lru_cacheimport customtkinter as ctkfrom customtkinter import CTkImagefrom PIL import Imageimport tkinter as tk  # 仅用于异常处理中的tk.messageboxdef resize_image(path: str, size: tuple[int, int]) -> CTkImage | None:    """使用CTkImage处理图片缩放"""    try:        with Image.open(path) as img:            img.thumbnail(size)            return CTkImage(                light_image=img,                dark_image=img,                size=img.size  # 保持原始比例            )    except Exception as e:        print(f"图片处理失败: {str(e)}")        return Nonedef open_image_preview(path: str):    """使用CTk组件实现图片预览"""    try:        top = ctk.CTkToplevel()        top.title("图片预览")        # 加载原始尺寸图片        preview_image = CTkImage(            light_image=Image.open(path),            dark_image=Image.open(path),            size=(800, 600))  # 限制最大预览尺寸        label = ctk.CTkLabel(top, image=preview_image, text="")        label.image = preview_image  # 保持引用防止被垃圾回收        label.pack(padx=20, pady=20)    except Exception as e:        # 使用tkinter的messagebox确保异常时能显示错误        tk.messagebox.showerror("预览错误", f"无法加载图片: {str(e)}")@lru_cache(maxsize=1000)def get_pinyin_initials(text: str) -> str:    """带缓存的拼音首字母生成"""    from pypinyin import lazy_pinyin    return ''.join([s[0] for s in lazy_pinyin(text)] if text else "")